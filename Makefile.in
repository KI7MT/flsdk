# Makefile for Linux for FLSDK
# Re-direct stdout and stderr:		bash
#								make >& junk
#
# Prerequisites: Bash, Git, Autotools, Dialog, Zenity, CoreUtils

# program informaiton
PROGRAM		=	@PROGRAM@
VERSION		=	@VERSION@
AUTHOR		=	@AUTHOR@
BUGS		=	@BUGS@
WEB			=	@WEB@

# system informaiton
DESC		=	@DESC@
OS			=	@HOST_OS@
ARCH		=	@HOST_CPU@
CPUS		=	@CPUS@

# general tools
AWK			:=	@AWK@
A2X			:=	@A2X@
CP			:=	@CP@
CHOWN		:=	@CHOWN@
CHMOD		:=	@CHMOD@
LN			:=	@LN@
MV			:=	@MV@
RM			:=	@RM@
SED			:=	@SED@
SHELL		:=	@SHELL@
GIT			:=	@GIT@
MKDIR		:=	@MKDIR@

# directories
INSTALL		:=	install
PREFIX		:=	@PREFIX@
BINDIR		:=	@BINDIR@
SHARE		:=	@SHARE@
MANDIR		:=	@MANDIR@
DOCDIR		:=	@DOCDIR@
WATCHD		:=	@WATCHD@
DOCSRC		:=	@DOCSRC@

# home folder related
LOGNAME		:=	@LOGNAME@
LOGGRP		:=	$(shell groups @LOGNAME@ | cut -d ' ' -f 3)
HOMEDIR		:=	/home/@LOGNAME@/flsdk

# package information
SCRIPTS		:=	$(wildcard src/*.sh)
PKGINFO		:=	./pkg-info.txt

# for manpages and docs
ASCIIDOC	:=	@ASCIIDOC@
A2X			:=	@A2X@
BDOC		:=	@BDOC@
MANSRC		:= $(wildcard manpages/*.1.txt)
MANP		:=	@MANP@

# enable folder separation
SEPARATE	:=	@SEPARATE@

# config definitions
DEFS		:=	@DEFS@

# foreground colours
C_R			:=	'\033[01;31m'	# red
C_G			:=	'\033[01;32m'	# green
C_Y			:=	'\033[01;33m'	# yellow
C_C			:=	'\033[01;36m'	# cyan
C_NC		:=	'\033[01;37m'	# no color

# Targets
all: conf-scripts build-doc build-manp make-summary

conf-scripts:
	@echo ''
	@echo '---------------------------------------------'
	@echo -e $(C_Y)"Update Build Scripts"$(C_NC)
	@echo '---------------------------------------------'
	@echo '' # Nothing to do at this time.
	@echo " Finished"  
	@echo ''

build-doc:
ifeq ($(BDOC),Yes)
	@echo '---------------------------------------------'
	@echo -e $(C_Y)"Building Documentation"$(C_NC)
	@echo '---------------------------------------------'
	@echo ''
	@echo " Building $(PROGRAM) User Guide..."
	@$(ASCIIDOC) -b xhtml11 -a data-uri -a toc2 -o flsdk.html $(DOCSRC)/flsdk-main.adoc
	@echo " Finished"  
	@echo ''
endif

build-manp:
ifeq ($(MANP),Yes)
	@echo '---------------------------------------------'
	@echo -e $(C_Y)"Building Manpages"$(C_NC)
	@echo '---------------------------------------------'
	@echo ''
	@echo " Building $(PROGRAM) Manpages..."
	@for f in $(MANSRC) ; do \
	echo " $$f" ; \
	$(A2X) --doctype manpage --format manpage --no-xmllint $$f ; \
	done
	@echo ' Finished'
	@echo ''
endif

make-summary:
	@echo ''
	@echo '---------------------------------------------'
	@echo -e $(C_G)"Make Summary"$(C_NC)
	@echo '---------------------------------------------'
	@echo ''
	@echo " Package ...................: $(PROGRAM) $(VERSION)"
	@echo " Install prefix ............: $(PREFIX)"
	@echo " Working Directory .........: $(HOMEDIR)"
	@echo ''
	@echo ' To Install, type ..........: sudo make install'
	@echo ''

install: 
	@echo ''
	@echo '---------------------------------------------'
	@echo -e $(C_R)"UNDER DEVELOPMENT"$(C_NC)
	@echo '---------------------------------------------'
	@echo '' 
	@echo " $(PROGRAM) is undergoing extensive re-writing."
	@echo ' It is not possible to perform a working installation'
	@echo ' at this time.'
	@echo ''
	@echo " Users should continue to use $(PROGRAM) v0.0.2 until"
	@echo ' further notice.'
	@echo '' 

# Uninstall System Files
uninstall:
	@clear
	@echo '---------------------------------------------'
	@echo -e $(C_Y)"Uninstall $(PROGRAM) $(VERSION)"$(C_NC)
	@echo '---------------------------------------------'
	@echo ''
	@echo '..Removing installed scripts'
	@$(RM) -f $(DESTDIR)$(BINDIR)/flsdk*
	@echo '..Removing installed docs and manpages'
	@$(RM) -f ${DESTDIR}$(MANDIR)/flsdk.1
	@echo '..Removing installed share files'
	@$(RM) -rf $(DESTDIR)$(SHARE)
	@$(RM) -f $(ICOND)/flsdk.xpm
	@$(RM) -f $(DTDIR)/flsdk.desktop
	@echo ''
	@echo 'UNINSTALL NOTES'
	@echo ''
	@echo ' 1. All user generated files remain in:'
	@echo "    PATH: $(HOMEDIR)"
	@echo ''
	@echo ' 2. All packages that were installed ( if any )'
	@echo '    during the configure and installation phase'
	@echo '    *have not* been removed automatically. This'
	@echo '    is by design, as it can potentially break'
	@echo '    system or application package dependencies.'
	@echo '    A list of installed packages can be found in:'
	@echo ''
	@echo "    PATH: $(HOMEDIR)/package-info/orig-needed.txt"
	@echo ''

# Cleanup Source Tree
.PHONY: clean simulate list-needed
clean:
	${RM} -f src/flsdk src/flsdk-fldigi src/flsdk-flamp src/flsdk-flmsg \
	src/flsdk-flrig src/flsdk-flwkey src/flsdk-fllog src/flsdk-flnet \
	src/flsdk-flwrap src/flsdk-versions config.log config.status \
	configure.scan configure Makefile src/language/language_en \
	data/flsdk.desktop pkg-info.txt
	${RM} -rf ./autom4*
	$(RM) -f docs/*.html docs/Makefile
	$(RM) -f manpages/*.1 manpages/*.1.txt
	

